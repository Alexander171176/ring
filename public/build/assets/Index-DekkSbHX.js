import{u as G,l as D,C as K,z as Q,e as Y,o as d,w as S,f as a,I as P,t as c,k as h,aH as ee,m as b,F as _,v as f,ai as te,q as oe,i as ae,p as se,N as re,O as ne,aI as R,aJ as k,aK as le,aL as p,aM as B,aN as O,aO as I,aP as E,aQ as T,aR as z,aS as ie,aT as de,aU as ce,aV as pe}from"./vendor-KLnQVH-z.js";import{A as ue}from"./AdminLayout-DDIonVUW.js";import{T as be}from"./TitlePage-Dn5_Db7V.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-axios-jn5v1YEJ.js";import"./vendor-lodash-p73LerAr.js";import"./ScrollButtons-D6M3P1oi.js";import"./ResponsiveNavLink-GNuCPEap.js";import"./LocaleSelectOption-DQWMhK86.js";import"./app-CpeRQVat.js";import"./auth-image-XbvYdkSi.js";const w=y=>(re("data-v-67060381"),y=y(),ne(),y),he={class:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-12xl mx-auto"},ve={class:"sm:flex sm:justify-between sm:items-center mb-4 p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95"},ge={for:"reportType",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},xe=w(()=>a("option",{value:"rubrics"},"Рубрики",-1)),we=w(()=>a("option",{value:"articles"},"Статьи",-1)),ye=w(()=>a("option",{value:"sections"},"Секции",-1)),_e=[xe,we,ye],fe={class:"mt-4 sm:mt-0 sm:ml-4"},ke={class:"p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95"},$e={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Ce={class:"mt-2 grid grid-cols-4 gap-2"},De=["value"],Se={class:"ml-2 text-gray-700 dark:text-gray-300"},Te={ref:"reportContent",id:"reportContent",class:"p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95 text-xs"},je={class:"text-md font-semibold mb-4 dark:text-white"},Ae=w(()=>a("div",{class:"overflow-x-auto mb-2"},[a("div",{class:"h-2"})],-1)),Fe={class:"overflow-x-auto"},Pe={class:"min-w-full bg-white dark:bg-gray-800 dark:text-white text-xxs"},Re={class:"dark:text-slate-700"},Be=w(()=>a("div",{class:"overflow-x-auto mt-2"},[a("div",{class:"h-2"})],-1)),Oe={__name:"Index",setup(y){const{t:v}=G(),r=D("rubrics"),u=D([]),l=D([]),$=new Date().toLocaleDateString("ru-RU"),i=new Date().toISOString().slice(0,19).replace(/:/g,"-"),j=async()=>{try{const s=await fetch(`/admin/reports?type=${r.value}`,{headers:{Accept:"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const e=await s.json();u.value=e.data,e.data.length>0&&(l.value=Object.keys(e.data[0]))}catch(s){console.error("Не удалось получить данные:",s)}};K(r,j),Q(j);const g=s=>s.map(e=>{const t={};return l.value.forEach(o=>{o==="rubrics"&&Array.isArray(e[o])?t[o]=e[o].map(n=>n.title).join(", "):o==="sections"&&Array.isArray(e[o])?t[o]=e[o].map(n=>n.title).join(", "):o==="articles"&&Array.isArray(e[o])?t[o]=e[o].map(n=>n.title).join(", "):t[o]=e[o]}),typeof t.activity=="boolean"&&(t.activity=t.activity?"true":"false"),t}),x=s=>{switch(s){case"csv":V();break;case"xls":N();break;case"pdf":L();break;case"zip":q();break;case"docx":H();break}},V=()=>{const s=g(u.value),e=p.json_to_sheet(s),t=p.sheet_to_csv(e),o=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"});k.saveAs(o,`reports_${r.value}_${i}.csv`)},N=()=>{const s=g(u.value),e=p.json_to_sheet(s),t=p.book_new();p.book_append_sheet(t,e,"Report");const o=B(t,{bookType:"xlsx",type:"array"}),n=new Blob([o],{type:"application/octet-stream"});k.saveAs(n,`reports_${r.value}_${i}.xlsx`)},L=()=>{const s=g(u.value),e=l.value.map(m=>`<th style="padding: 5px; border: 1px solid black;">${m}</th>`).join(""),t=s.map(m=>`<tr>${l.value.map(C=>`<td style="padding: 5px; padding-bottom: 10px; border: 1px solid black;">${m[C]}</td>`).join("")}</tr>`).join(""),o=`
    <html>
      <head>
        <style>
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { padding: 5px; border: 1px solid black; vertical-align: top; }
          h1 { margin-bottom: 20px; }
        </style>
      </head>
      <body>
        <h1>Отчёт: ${r.value==="rubrics"?"Рубрики":r.value==="sections"?"Секции":"Статьи"} - ${$}</h1>
        <table>
          <thead><tr>${e}</tr></thead>
          <tbody>${t}</tbody>
        </table>
      </body>
    </html>
  `,n={margin:.5,filename:`reports_${r.value}_${i}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,letterRendering:!0,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"landscape"}};O().from(o).set(n).save()},q=async()=>{const s=new le,e=g(u.value),t=p.json_to_sheet(e),o=p.sheet_to_csv(t),n=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"});s.file(`reports_${r.value}_${i}.csv`,n);const m=p.book_new();p.book_append_sheet(m,t,"Report");const F=B(m,{bookType:"xlsx",type:"array"}),C=new Blob([F],{type:"application/octet-stream"});s.file(`reports_${r.value}_${i}.xlsx`,C);const M=document.querySelector("#reportContent"),U={margin:.5,filename:`reports_${r.value}_${i}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,letterRendering:!0,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"landscape"}},X=await O().from(M).set(U).output("blob");s.file(`reports_${r.value}_${i}.pdf`,X);const Z=A(),J=await R.toBlob(Z);s.file(`reports_${r.value}_${i}.docx`,J);const W=await s.generateAsync({type:"blob"});k.saveAs(W,`reports_${r.value}_${i}.zip`)},H=()=>{const s=A();R.toBlob(s).then(e=>{k.saveAs(e,`reports_${r.value}_${i}.docx`)})},A=()=>{const s=g(u.value),e=[new I({children:l.value.map(t=>new E({children:[new T({children:[new z(t)],spacing:{after:200}})]}))})];return s.forEach(t=>{const o=new I({children:l.value.map(n=>new E({children:[new T({children:[new z(String(t[n]))],spacing:{after:200}})]}))});e.push(o)}),new ie({sections:[{properties:{page:{size:{orientation:ce.LANDSCAPE}}},children:[new T({text:`Отчёт: ${r.value==="rubrics"?"Рубрики":r.value==="sections"?"Секции":"Статьи"} - ${$}`,heading:"Heading1",spacing:{after:400}}),new de({rows:e,width:{size:100,type:pe.PERCENTAGE}})]}]})};return(s,e)=>(d(),Y(ue,{title:h(v)("reports")},{header:S(()=>[ae(be,null,{default:S(()=>[se(c(h(v)("reports")),1)]),_:1})]),default:S(()=>[a("div",he,[a("div",ve,[a("div",null,[a("label",ge,c(h(v)("selectReportType")),1),P(a("select",{id:"reportType","onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),class:"mt-1 block w-full py-1 px-3 border border-gray-300 bg-white dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},_e,512),[[ee,r.value]])]),a("div",fe,[a("button",{onClick:e[1]||(e[1]=t=>x("csv")),class:"inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700"}," CSV "),a("button",{onClick:e[2]||(e[2]=t=>x("xls")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700"}," Excel "),a("button",{onClick:e[3]||(e[3]=t=>x("docx")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"}," Word "),a("button",{onClick:e[4]||(e[4]=t=>x("pdf")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700"}," PDF "),a("button",{onClick:e[5]||(e[5]=t=>x("zip")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-slate-600 hover:bg-slate-700"}," ZIP ")])]),a("div",ke,[a("label",$e,c(h(v)("selectFieldsPrint")),1),a("div",Ce,[(d(!0),b(_,null,f(u.value[0],(t,o)=>(d(),b("div",{key:o},[P(a("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>l.value=n),value:o,class:"form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out"},null,8,De),[[te,l.value]]),a("span",Se,c(o),1)]))),128))])]),a("div",Te,[a("h1",je,c(h(v)("report"))+" "+c(r.value==="rubrics"?"Рубрики":r.value==="sections"?"Секции":"Статьи")+" - "+c(h($)),1),Ae,a("div",Fe,[a("table",Pe,[a("thead",null,[a("tr",Re,[(d(!0),b(_,null,f(l.value,t=>(d(),b("th",{key:t,class:"px-4 py-1 dark:bg-gray-900 dark:text-white"},c(t),1))),128))])]),a("tbody",null,[(d(!0),b(_,null,f(u.value,t=>(d(),b("tr",{key:t.id,class:"bg-white dark:bg-gray-800 border-b dark:border-gray-700"},[(d(!0),b(_,null,f(l.value,o=>(d(),b("td",{key:o,class:oe([{truncate:o==="url"||o==="image_url"},"px-4 py-1"])},c(t[o]),3))),128))]))),128))])])]),Be],512)])]),_:1},8,["title"]))}},Ze=me(Oe,[["__scopeId","data-v-67060381"]]);export{Ze as default};
