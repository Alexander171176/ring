import{u as P,l as b,C as O,m as T,o as f,f as s,i as _,t as l,k as n,w as k,D as K,y as G,E as w,G as B,e as C,n as D,p as N}from"./vendor-RLSRVg0u.js";import{A as Q}from"./AdminLayout-BKlaFo32.js";import{T as R}from"./TitlePage-FZyLO7ZL.js";import{_ as q}from"./DefaultButton-nL57tpOx.js";import{_ as W,a as X,b as Y}from"./CountTable-BB0DAeyh.js";import{_ as Z,a as ee,b as te}from"./SearchInput-CHCcR2M1.js";import{_ as se}from"./ActivityToggle-CdHhqwhx.js";import{_ as ae}from"./IconEdit-BtD_rftc.js";import"./vendor-axios-jn5v1YEJ.js";import"./vendor-lodash-xl9ghVBF.js";import"./ScrollButtons-Bf8O8t11.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationMark-xXghvFch.js";import"./ResponsiveNavLink-BMppKKTO.js";import"./LocaleSelectOption-B-81EClK.js";import"./app-DnDP20Mi.js";import"./auth-image-XbvYdkSi.js";const oe={class:"bg-white dark:bg-slate-700 shadow-lg rounded-sm border border-slate-200 dark:border-slate-600 relative"},ne={class:"overflow-x-auto"},le={key:0,class:"table-auto w-full text-slate-700 dark:text-slate-100"},re={class:"text-sm font-semibold uppercase bg-slate-200 dark:bg-cyan-900 border border-solid border-gray-300 dark:border-gray-700"},ie={class:"px-2 py-1 whitespace-nowrap w-1/12"},ce={class:"font-medium text-center"},ue={class:"px-2 py-1 whitespace-nowrap w-2/12"},de={class:"font-medium text-left"},me={class:"px-2 py-1 whitespace-nowrap w-2/12"},pe={class:"font-medium text-left"},ve={class:"px-2 py-1 whitespace-nowrap w-2/12"},_e={class:"font-medium text-left"},he={class:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap"},fe={class:"font-semibold text-end"},ge={class:"px-2 first:pl-7 last:pr-7 py-3 whitespace-nowrap"},ye={class:"text-center font-medium"},xe={class:"text-sm font-semibold border-b-2 hover:bg-slate-100 dark:hover:bg-cyan-800"},be={class:"px-2 py-1 whitespace-nowrap w-1/12"},we=["title"],ke={class:"px-2 py-1 whitespace-nowrap w-2/12"},$e=["title"],Se={class:"px-2 py-1 whitespace-nowrap w-2/12"},Te=["title"],Ae={class:"px-2 py-1 whitespace-nowrap text-right w-2/12"},Ce={class:"flex justify-end space-x-2"},De={class:"px-2 first:pl-7 last:pr-7 py-1 whitespace-nowrap"},Pe={class:"text-center"},Ee=["checked","onChange"],Ue={key:1,class:"p-5 text-center text-slate-700 dark:text-slate-100"},Ve={__name:"TournamentTable",props:{tournaments:Array,selectedTournaments:Array},emits:["toggle-activity","edit","delete","update-sort-order","toggle-select","toggle-all"],setup(m,{emit:p}){const{t:a}=P(),g=m,u=p,r=i=>a(i?`tournamentStatus${i.charAt(0).toUpperCase()+i.slice(1)}`:"unknown"),$=i=>i?new Date(i).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):a("unknown"),v=b([]);O(()=>g.tournaments,i=>{v.value=JSON.parse(JSON.stringify(i||[]))},{immediate:!0,deep:!0});const S=()=>{const i=v.value.map(y=>y.id);u("update-sort-order",i)},E=i=>{const y=i.target.checked,c=v.value.map(x=>x.id);u("toggle-all",{ids:c,checked:y})};return(i,y)=>(f(),T("div",oe,[s("div",ne,[m.tournaments.length>0?(f(),T("table",le,[s("thead",re,[s("tr",null,[s("th",ie,[s("div",ce,l(n(a)("id")),1)]),s("th",ue,[s("div",de,l(n(a)("name")),1)]),s("th",me,[s("div",pe,l(n(a)("venue")),1)]),s("th",ve,[s("div",_e,l(n(a)("status")),1)]),s("th",he,[s("div",fe,l(n(a)("actions")),1)]),s("th",ge,[s("div",ye,[s("input",{type:"checkbox",onChange:E},null,32)])])])]),_(n(K),{tag:"tbody",modelValue:v.value,"onUpdate:modelValue":y[0]||(y[0]=c=>v.value=c),onEnd:S,itemKey:"id"},{item:k(({element:c})=>[s("tr",xe,[s("td",be,[s("div",{class:"text-center text-blue-600 dark:text-blue-200",title:c.locale},l(c.id),9,we)]),s("td",ke,[s("div",{class:"text-left text-amber-500 dark:text-amber-200",title:$(c.tournament_date_time)},l(c.name),9,$e)]),s("td",Se,[s("div",{class:"text-left text-teal-500 dark:text-teal-200",title:r(c.status)},l(c.venue),9,Te)]),s("td",Ae,[s("div",Ce,[_(se,{isActive:c.activity,onToggleActivity:x=>i.$emit("toggle-activity",c),title:c.activity?n(a)("enabled"):n(a)("disabled")},null,8,["isActive","onToggleActivity","title"]),_(ae,{href:i.route("admin.tournaments.edit",c.id)},null,8,["href"]),_(W,{onClick:x=>i.$emit("delete",c.id)},null,8,["onClick"])])]),s("td",De,[s("div",Pe,[s("input",{type:"checkbox",checked:m.selectedTournaments.includes(c.id),onChange:x=>i.$emit("toggle-select",c.id)},null,40,Ee)])])])]),_:1},8,["modelValue"])])):(f(),T("div",Ue,l(n(a)("noData")),1))])]))}},Be={class:"flex flex-col sm:flex-row items-center"},Ne={class:"block mb-2 sm:mb-0 sm:mr-2 font-semibold text-sm text-slate-700 dark:text-slate-500"},Oe={value:"",disabled:"",selected:""},je={value:"selectAll"},Ie={value:"deselectAll"},Me={value:"activate"},Le={value:"deactivate"},ze={__name:"BulkActionSelect",props:{handleBulkAction:Function},emits:["change"],setup(m,{emit:p}){const{t:a}=P();return(g,u)=>(f(),T("div",Be,[s("label",Ne,l(n(a)("bulkActions")),1),s("select",{class:"w-auto px-3 py-0.5 form-select bg-white dark:bg-gray-200 text-gray-600 dark:text-gray-900 border border-slate-400 dark:border-slate-600 rounded-sm shadow-sm",onChange:u[0]||(u[0]=r=>g.$emit("change",r))},[s("option",Oe,l(n(a)("selectAction")),1),s("option",je,l(n(a)("selectAll")),1),s("option",Ie,l(n(a)("deselectAll")),1),s("option",Me,l(n(a)("activate")),1),s("option",Le,l(n(a)("deactivate")),1)],32)]))}},Fe={class:"flex justify-center items-center h-fit sm:mr-4 mt-2 mb-2"},He={for:"sortParam",class:"hidden lg:block sm:mr-2 tracking-wider text-sm font-semibold text-slate-600 dark:text-slate-100"},Je=["value"],Ke={value:"idDesc"},Ge={value:"idAsc"},Qe={value:"sort"},Re={value:"name"},qe={value:"locale"},We={value:"status"},Xe={value:"activity"},Ye={value:"inactive"},Ze={__name:"SortSelect",props:{sortParam:String},emits:["update:sortParam"],setup(m,{emit:p}){const{t:a}=P(),g=p,u=r=>{g("update:sortParam",r.target.value)};return(r,$)=>(f(),T("div",Fe,[s("label",He,l(n(a)("sort")),1),s("select",{id:"sortParam",value:m.sortParam,onChange:u,class:"w-36 px-3 py-0.5 form-select bg-white dark:bg-gray-200 text-gray-600 dark:text-gray-900 border border-slate-400 dark:border-slate-600 rounded-sm shadow-sm"},[s("option",Ke,l(n(a)("idDesc")),1),s("option",Ge,l(n(a)("idAsc")),1),s("option",Qe,l(n(a)("sortNumber")),1),s("option",Re,l(n(a)("name")),1),s("option",qe,l(n(a)("localization")),1),s("option",We,l(n(a)("status")),1),s("option",Xe,l(n(a)("active")),1),s("option",Ye,l(n(a)("inactive")),1)],40,Je)]))}},et={class:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-12xl mx-auto"},tt={class:"p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95"},st={class:"sm:flex sm:justify-between sm:items-center mb-2"},at=s("svg",{class:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16"},[s("path",{d:"M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"})],-1),ot={key:2,class:"flex justify-between items-center flex-col md:flex-row my-1"},wt={__name:"Index",props:["tournaments","tournamentsCount","adminCountTournaments","adminSortTournaments"],setup(m){const{t:p}=P(),a=G(),g=m,u=b(g.adminCountTournaments);O(u,t=>{w.put(route("admin.settings.updateAdminCountTournaments"),{value:t},{preserveScroll:!0,preserveState:!0,onSuccess:()=>a.info(`Показ ${t} элементов на странице.`),onError:e=>a.error(e.value||"Ошибка обновления кол-ва элементов.")})});const r=b(g.adminSortTournaments);O(r,t=>{w.put(route("admin.settings.updateAdminSortTournaments"),{value:t},{preserveScroll:!0,preserveState:!0,onSuccess:()=>a.info("Сортировка успешно изменена"),onError:e=>a.error(e.value||"Ошибка обновления сортировки.")})});const $=b(!1),v=b(null),S=b(""),E=(t,e)=>{v.value=t,S.value=e,$.value=!0},i=()=>{$.value=!1,v.value=null,S.value=""},y=()=>{if(v.value===null)return;const t=v.value,e=S.value;w.delete(route("admin.tournaments.destroy",{tournament:t}),{preserveScroll:!0,preserveState:!1,onSuccess:o=>{i(),a.success(`Турнир "${e||"ID: "+t}" удален.`)},onError:o=>{i();const h=o.general||o[Object.keys(o)[0]]||"Произошла ошибка при удалении.";a.error(`${h} (Турнир: ${e||"ID: "+t})`),console.error("Ошибка удаления:",o)},onFinish:()=>{v.value=null,S.value=""}})},c=t=>{const e=!t.activity,o=e?"активирован":"деактивирован";w.put(route("admin.actions.tournaments.updateActivity",{tournament:t.id}),{activity:e},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{a.success(`Турнир "${t.name}" ${o}.`)},onError:h=>{a.error(h.activity||h.general||`Ошибка изменения активности для "${t.name}".`)}})},x=b(1),A=b(""),I=t=>r.value==="idAsc"?t.slice().sort((e,o)=>e.id-o.id):r.value==="idDesc"?t.slice().sort((e,o)=>o.id-e.id):r.value==="activity"?t.filter(e=>e.activity):r.value==="inactive"?t.filter(e=>!e.activity):r.value==="locale"?t.slice().sort((e,o)=>e.locale<o.locale?1:e.locale>o.locale?-1:0):r.value==="views"?t.slice().sort((e,o)=>o[r.value]-e[r.value]):t.slice().sort((e,o)=>e[r.value]<o[r.value]?-1:e[r.value]>o[r.value]?1:0),U=B(()=>{let t=g.tournaments;return A.value&&(t=t.filter(e=>e.name.toLowerCase().includes(A.value.toLowerCase()))),I(t)}),V=B(()=>{const t=(x.value-1)*u.value;return U.value.slice(t,t+u.value)});B(()=>Math.ceil(U.value.length/u.value));const M=t=>{const e=(x.value-1)*u.value,o=t.map((h,J)=>({id:h,sort:e+J+1}));w.put(route("admin.actions.tournaments.updateSortBulk"),{tournaments:o},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{a.success("Порядок турниров успешно обновлен.")},onError:h=>{console.error("Ошибка обновления сортировки:",h),a.error(h.general||h.tournaments||"Не удалось обновить порядок турниров."),w.reload({only:["tournaments"],preserveScroll:!0})}})},d=b([]),L=({ids:t,checked:e})=>{e?d.value=[...new Set([...d.value,...t])]:d.value=d.value.filter(o=>!t.includes(o))},z=t=>{const e=d.value.indexOf(t);e>-1?d.value.splice(e,1):d.value.push(t)},j=t=>{if(!d.value.length){a.warning("Выберите теги для активации/деактивации турниров");return}axios.put(route("admin.actions.tournaments.bulkUpdateActivity"),{ids:d.value,activity:t}).then(()=>{a.success("Активность массово обновлена");const e=[...d.value];d.value=[],V.value.forEach(o=>{e.includes(o.id)&&(o.activity=t)})}).catch(()=>{a.error("Не удалось обновить активность")})},F=()=>{if(d.value.length===0){a.warning("Выберите хотя бы один тег для удаления.");return}confirm("Вы уверены, что хотите их удалить ?")&&w.delete(route("admin.actions.tournaments.bulkDestroy"),{data:{ids:d.value},preserveScroll:!0,preserveState:!1,onSuccess:t=>{d.value=[],a.success("Массовое удаление турниров успешно завершено.")},onError:t=>{console.error("Ошибка массового удаления:",t);const e=Object.keys(t)[0],o=t[e]||"Произошла ошибка при удалении турниров.";a.error(o)}})},H=t=>{const e=t.target.value;e==="selectAll"?d.value=V.value.map(o=>o.id):e==="deselectAll"?d.value=[]:e==="activate"?j(!0):e==="deactivate"?j(!1):e==="delete"&&F(),t.target.value=""};return(t,e)=>(f(),C(Q,{title:n(p)("tournaments")},{header:k(()=>[_(R,null,{default:k(()=>[N(l(n(p)("tournaments")),1)]),_:1})]),default:k(()=>[s("div",et,[s("div",tt,[s("div",st,[_(q,{href:t.route("admin.tournaments.create")},{icon:k(()=>[at]),default:k(()=>[N(" "+l(n(p)("addTournament")),1)]),_:1},8,["href"]),m.tournamentsCount?(f(),C(ze,{key:0,onChange:H})):D("",!0)]),m.tournamentsCount?(f(),C(Z,{key:0,modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=o=>A.value=o),placeholder:n(p)("searchByName")},null,8,["modelValue","placeholder"])):D("",!0),m.tournamentsCount?(f(),C(X,{key:1},{default:k(()=>[N(l(m.tournamentsCount),1)]),_:1})):D("",!0),_(Ve,{tournaments:V.value,"selected-tournaments":d.value,onToggleActivity:c,onUpdateSortOrder:M,onDelete:E,onToggleSelect:z,onToggleAll:L},null,8,["tournaments","selected-tournaments"]),m.tournamentsCount?(f(),T("div",ot,[_(ee,{"items-per-page":u.value,"onUpdate:itemsPerPage":e[1]||(e[1]=o=>u.value=o)},null,8,["items-per-page"]),_(te,{"current-page":x.value,"items-per-page":u.value,"total-items":U.value.length,"onUpdate:currentPage":e[2]||(e[2]=o=>x.value=o),"onUpdate:itemsPerPage":e[3]||(e[3]=o=>u.value=o)},null,8,["current-page","items-per-page","total-items"]),_(Ze,{sortParam:r.value,"onUpdate:sortParam":e[4]||(e[4]=o=>r.value=o)},null,8,["sortParam"])])):D("",!0)])]),_(Y,{show:$.value,onClose:i,onCancel:i,onConfirm:y,cancelText:n(p)("cancel"),confirmText:n(p)("yesDelete")},null,8,["show","cancelText","confirmText"])]),_:1},8,["title"]))}};export{wt as default};
