import{u as M,m as _,o as b,f as s,t as c,k as o,l as S,C as N,H as P,I as G,i as f,q as j,w as h,p as E,J as F,A as Q,K as W,L as X,D as H,y as Y,e as I,n as z,F as Z,v as ee,M as te,N as ae,O as se,E as D}from"./vendor-KLnQVH-z.js";import{A as le}from"./AdminLayout-B5bZFClc.js";import{T as oe}from"./TitlePage-Dn5_Db7V.js";import{_ as re}from"./DefaultButton-mNfyXOKI.js";import{_ as ie,a as ne,b as ce}from"./CountTable-BG0LS_kA.js";import{_ as de}from"./ActivityToggle-BMpL71vi.js";import{_ as ue}from"./IconEdit-BSiKqtPt.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-axios-jn5v1YEJ.js";import"./vendor-lodash-p73LerAr.js";import"./ScrollButtons-BQ3VHXoa.js";import"./ResponsiveNavLink-GNuCPEap.js";import"./LocaleSelectOption-DmkMWodN.js";import"./app-1bgHo_eX.js";import"./auth-image-XbvYdkSi.js";const me={class:"flex flex-col sm:flex-row items-center"},he={class:"block mb-2 sm:mb-0 sm:mr-2 font-semibold text-sm text-slate-700 dark:text-slate-500"},ve={value:"",disabled:"",selected:""},fe={value:"selectAll"},ye={value:"deselectAll"},xe={value:"activate"},be={value:"deactivate"},ke={__name:"BulkActionSelect",props:{handleBulkAction:Function},emits:["change"],setup(e,{emit:u}){const{t:r}=M();return(C,g)=>(b(),_("div",me,[s("label",he,c(o(r)("bulkActions")),1),s("select",{class:"w-auto px-3 py-0.5 form-select bg-white dark:bg-gray-200 text-gray-600 dark:text-gray-900 border border-slate-400 dark:border-slate-600 rounded-sm shadow-sm",onChange:g[0]||(g[0]=v=>C.$emit("change",v))},[s("option",ve,c(o(r)("selectAction")),1),s("option",fe,c(o(r)("selectAll")),1),s("option",ye,c(o(r)("deselectAll")),1),s("option",xe,c(o(r)("activate")),1),s("option",be,c(o(r)("deactivate")),1)],32)]))}},pe={class:"flex items-center justify-between py-1 px-3 border border-gray-400 rounded-sm bg-white dark:bg-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 transition duration-150 ease-in-out"},$e={class:"flex items-center space-x-2 flex-grow min-w-0"},we=["title"],Ce=s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",class:"w-4 h-4"},[s("path",{class:"fill-current text-sky-500 dark:text-sky-200",d:"M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8l32 0 0 96-96 0 0-32c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6l0-32 96 0 0 96-32 0c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8l-32 0 0-96 96 0 0 32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 32-96 0 0-96 32 0c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"})],-1),Ae=[Ce],Se=["title"],_e=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1),Te=[_e],De={key:1,class:"w-4 h-4 inline-block flex-shrink-0"},Ee=["checked"],Ie={class:"font-semibold text-sm text-amber-600 dark:text-amber-200 mr-1 flex-shrink-0"},Ve={class:"flex items-center space-x-1 flex-shrink-0 ml-4"},Be={class:"children-container mt-1"},Le={__name:"CategoryTreeItem",props:{category:Object,level:Number,selectedCategories:Array},emits:["toggle-activity","delete","toggle-select","request-drag-end"],setup(e,{emit:u}){const{t:r}=M(),C=e,g=u,v=S(!0);N(()=>C.category,(m,i)=>{},{deep:!0}),N(()=>C.selectedCategories,(m,i)=>{},{deep:!0});const A=m=>{g("request-drag-end",m)},T=()=>{v.value=!v.value};return(m,i)=>{const V=P("CategoryTreeItem",!0);return b(),_("div",null,[s("div",{class:"category-item mb-1",style:W({marginLeft:e.level*20+"px"})},[s("div",pe,[s("div",$e,[s("span",{class:"handle cursor-move mr-1 flex-shrink-0",title:o(r)("dragDrop")},Ae,8,we),e.category.children&&e.category.children.length?(b(),_("button",{key:0,title:v.value?o(r)("collapse"):o(r)("expand"),onClick:T,class:"flex-shrink-0 text-slate-900 hover:text-red-500 dark:text-slate-100 dark:hover:text-red-200"},[(b(),_("svg",{class:j(["w-5 h-5 transform transition-transform duration-150",{"rotate-90":v.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Te,2))],8,Se)):(b(),_("span",De)),s("input",{type:"checkbox",checked:e.selectedCategories.includes(e.category.id),onChange:i[0]||(i[0]=$=>m.$emit("toggle-select",e.category.id)),class:"form-checkbox rounded-sm text-indigo-500 flex-shrink-0"},null,40,Ee),s("span",Ie,c(e.category.id),1),f(o(F),{href:m.route("admin.categories.edit",e.category.id),class:"font-medium text-teal-600 dark:text-teal-100 hover:text-indigo-600 dark:hover:text-indigo-300 truncate",title:e.category.url},{default:h(()=>[E(c(e.category.title),1)]),_:1},8,["href","title"]),s("span",{class:j(["text-xs ml-1 px-1.5 py-0.5 rounded-sm border border-slate-400 flex-shrink-0",e.category.activity?"bg-amber-100 dark:bg-amber-700/50 text-amber-700 dark:text-amber-300":"bg-blue-200 dark:bg-blue-900/50 text-gray-900 dark:text-gray-100"])},c(e.category.locale.toUpperCase()),3)]),s("div",Ve,[f(de,{isActive:e.category.activity,onToggleActivity:i[1]||(i[1]=$=>m.$emit("toggle-activity",e.category)),title:e.category.activity?o(r)("enabled"):o(r)("disabled")},null,8,["isActive","title"]),f(ue,{href:m.route("admin.categories.edit",e.category.id)},null,8,["href"]),f(ie,{onClick:i[2]||(i[2]=Q($=>m.$emit("delete",e.category),["stop"]))})])])],4),G(s("div",Be,[f(o(H),{modelValue:e.category.children,"onUpdate:modelValue":i[6]||(i[6]=$=>e.category.children=$),tag:"div","item-key":"id",handle:".handle",group:"categories",onEnd:A,class:"category-tree-children","data-parent-id":e.category.id},{item:h(({element:$})=>[f(V,{category:$,level:e.level+1,"selected-categories":e.selectedCategories,onToggleActivity:i[3]||(i[3]=w=>m.$emit("toggle-activity",w)),onDelete:i[4]||(i[4]=w=>m.$emit("delete",w)),onToggleSelect:i[5]||(i[5]=w=>m.$emit("toggle-select",w)),onRequestDragEnd:A},null,8,["category","level","selected-categories"])]),_:1},8,["modelValue","data-parent-id"])],512),[[X,v.value&&e.category.children&&e.category.children.length]])])}}},Ne=e=>(ae("data-v-f52a1ca0"),e=e(),se(),e),je={class:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-12xl mx-auto"},Me={class:"p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95"},Oe={class:"sm:flex sm:justify-between sm:items-center mb-2"},Ue=Ne(()=>s("svg",{class:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16"},[s("path",{d:"M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"})],-1)),qe={class:"flex items-center justify-between mt-5"},ze={class:"flex items-center justify-end space-x-2 px-3 py-1 border-x border-t border-gray-400 rounded-t-lg bg-gray-100 dark:bg-gray-900"},Fe={class:"text-sm font-medium text-slate-700 dark:text-slate-200"},He={class:"flex items-center"},Je=["title"],Re={class:"bg-gray-300 dark:bg-gray-900 border border-gray-400 relative"},Ke={class:"p-4 text-center text-slate-500 dark:text-slate-400"},Pe={class:"p-4 text-center text-slate-900 dark:text-slate-100"},Ge={__name:"Index",props:{categories:Array,categoriesCount:Number,currentLocale:String,availableLocales:Array,errors:Object},setup(e){const{t:u}=M(),r=Y(),C=e,g=S([]);N(()=>C.categories,t=>{g.value=JSON.parse(JSON.stringify(t||[]))},{immediate:!0,deep:!0});const v=S(!1),A=S(null),T=S(""),m=t=>{A.value=t.id,T.value=t.title,v.value=!0},i=()=>{v.value=!1,A.value=null,T.value=""},V=()=>{if(A.value===null)return;const t=A.value,a=T.value;D.delete(route("admin.categories.destroy",{category:t}),{preserveScroll:!0,onSuccess:()=>{r.success(`Страница "${a||"ID: "+t}" удалена.`)},onError:l=>{const n=l.general||l[Object.keys(l)[0]]||"Произошла ошибка при удалении.";r.error(`${n} (Страница: ${a||"ID: "+t})`)},onFinish:()=>{i()}})},$=t=>{const a=!t.activity,l=u(a?"activated":"deactivated");D.put(route("admin.actions.categories.updateActivity",{category:t.id}),{activity:a},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{const n=(y,p,d)=>{for(const x of y){if(x.id===p)return x.activity=d,!0;if(x.children&&x.children.length>0&&n(x.children,p,d))return!0}return!1};n(g.value,t.id,a),r.success(`Страница "${t.title}" ${l}.`)},onError:n=>{r.error(n.activity||n.general||`Ошибка изменения активности для "${t.title}".`)}})},w=t=>{let a=[];const l=(y,p)=>{y.forEach((d,x)=>{let L=!1;d.sort!==x&&(d.sort=x,L=!0),d.parent_id!==p&&(L=!0),L&&a.push({id:d.id,sort:d.sort,parent_id:p}),d.children&&d.children.length&&l(d.children,d.id)})};l(g.value,null);const n=a.reduce((y,p)=>{const d=y.find(x=>x.id===p.id);return d?(Object.assign(d,p),y):y.concat([p])},[]);n.length>0?D.put(route("admin.actions.categories.updateSortBulk"),{categories:n,locale:C.currentLocale},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{r.success("Иерархия успешно обновлена")},onError:y=>{console.error("Ошибка обновления сортировки:",y),r.error(y.message||"Ошибка обновления иерархии"),D.reload({only:["categories"],preserveScroll:!0})}}):console.log("Никаких изменений в порядке сортировки нет.")},k=S([]),O=t=>{let a=[];return t.forEach(l=>{a.push(l.id),l.children&&l.children.length&&(a=a.concat(O(l.children)))}),a},B=t=>{var n;const a=(n=t.target)==null?void 0:n.checked,l=O(g.value);a===!0?k.value=l:a===!1&&(k.value=[])},J=t=>{const a=k.value.indexOf(t);a>-1?k.value.splice(a,1):k.value.push(t)},U=(t,a,l)=>{t.forEach(n=>{a.includes(n.id)&&(n.activity=l),n.children&&n.children.length&&U(n.children,a,l)})},q=t=>{if(!k.value.length){r.warning("Выберите страницы для активации/деактивации");return}const a=[...k.value];D.put(route("admin.actions.categories.bulkUpdateActivity"),{ids:a,activity:t},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{U(g.value,a,t),k.value=[],r.success("Статус активации массово обновлены")},onError:()=>{r.error("Произошла оштбка при массовом обновлении статуса активности")}})},R=t=>{const a=t.target.value;a==="selectAll"?B({target:{checked:!0}}):a==="deselectAll"?B({target:{checked:!1}}):a==="activate"?q(!0):a==="deactivate"&&q(!1),t.target.value=""},K=t=>route("admin.categories.index",{locale:t});return(t,a)=>(b(),I(le,{title:o(u)("categories")},{header:h(()=>[f(oe,null,{default:h(()=>[E(c(o(u)("categories")),1)]),_:1})]),default:h(()=>[s("div",je,[s("div",Me,[s("div",Oe,[f(re,{href:t.route("admin.categories.create",{locale:e.currentLocale})},{icon:h(()=>[Ue]),default:h(()=>[E(" "+c(o(u)("addCategory")),1)]),_:1},8,["href"]),e.categoriesCount>0?(b(),I(ke,{key:0,onChange:R})):z("",!0)]),s("div",qe,[s("div",ze,[s("span",Fe,c(o(u)("localization"))+": ",1),(b(!0),_(Z,null,ee(e.availableLocales,l=>(b(),I(o(F),{key:l,href:K(l),class:j(["px-3 py-1 text-sm font-medium rounded-sm",e.currentLocale===l?"bg-blue-500 text-white":"bg-slate-100 dark:bg-slate-900 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600"]),"preserve-scroll":"","preserve-state":""},{default:h(()=>[E(c(l.toUpperCase()),1)]),_:2},1032,["href","class"]))),128))]),s("div",He,[e.categoriesCount?(b(),I(ne,{key:0},{default:h(()=>[E(c(e.categoriesCount),1)]),_:1})):z("",!0),s("input",{type:"checkbox",id:"select-all-header",onChange:B,class:"form-checkbox rounded-sm text-indigo-500 ml-2",title:o(u)("selectAll")},null,40,Je)])]),s("div",Re,[f(o(H),{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),tag:"div","item-key":"id",handle:".handle",group:"categories",onEnd:w,class:"category-tree-root","data-parent-id":null},te({item:h(({element:l})=>[f(Le,{category:l,level:0,"selected-categories":k.value,onToggleActivity:$,onDelete:m,onToggleSelect:J,onRequestDragEnd:w},null,8,["category","selected-categories"])]),_:2},[g.value.length===0&&e.categoriesCount>0?{name:"header",fn:h(()=>[s("div",Ke,c(o(u)("loading"))+"... ",1)]),key:"0"}:void 0,g.value.length===0&&e.categoriesCount===0?{name:"footer",fn:h(()=>[s("div",Pe,c(o(u)("noData")),1)]),key:"1"}:void 0]),1032,["modelValue"])])])]),f(ce,{show:v.value,onClose:i,onCancel:i,onConfirm:V,cancelText:o(u)("cancel"),confirmText:o(u)("yesDelete")},null,8,["show","cancelText","confirmText"])]),_:1},8,["title"]))}},dt=ge(Ge,[["__scopeId","data-v-f52a1ca0"]]);export{dt as default};
