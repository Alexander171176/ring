import{u as G,l as D,C as K,z as Q,e as Y,o as d,w as S,f as a,I as P,t as c,k as h,aH as tt,m as b,F as _,v as f,ai as et,q as ot,i as at,p as st,N as rt,O as nt,aI as R,aJ as k,aK as lt,aL as p,aM as B,aN as O,aO as I,aP as E,aQ as T,aR as z,aS as it,aT as dt,aU as ct,aV as pt}from"./vendor-dXS4rpLM.js";import{A as ut}from"./AdminLayout-DlqRiydv.js";import{T as bt}from"./TitlePage-BRoK9FrY.js";import{_ as mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-axios-jn5v1YEJ.js";import"./vendor-lodash-BWwjE5JL.js";import"./ScrollButtons-r3m02qBw.js";import"./ApplicationMark-CAKZHMy4.js";import"./ResponsiveNavLink-DaQ3F65y.js";import"./LocaleSelectOption-BbFlFRNr.js";import"./app-005Ychus.js";import"./auth-image-XbvYdkSi.js";const w=y=>(rt("data-v-67060381"),y=y(),nt(),y),ht={class:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-12xl mx-auto"},vt={class:"sm:flex sm:justify-between sm:items-center mb-4 p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95"},gt={for:"reportType",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},xt=w(()=>a("option",{value:"rubrics"},"Рубрики",-1)),wt=w(()=>a("option",{value:"articles"},"Статьи",-1)),yt=w(()=>a("option",{value:"sections"},"Секции",-1)),_t=[xt,wt,yt],ft={class:"mt-4 sm:mt-0 sm:ml-4"},kt={class:"p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95"},$t={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Ct={class:"mt-2 grid grid-cols-4 gap-2"},Dt=["value"],St={class:"ml-2 text-gray-700 dark:text-gray-300"},Tt={ref:"reportContent",id:"reportContent",class:"p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-lg shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95 text-xs"},jt={class:"text-md font-semibold mb-4 dark:text-white"},At=w(()=>a("div",{class:"overflow-x-auto mb-2"},[a("div",{class:"h-2"})],-1)),Ft={class:"overflow-x-auto"},Pt={class:"min-w-full bg-white dark:bg-gray-800 dark:text-white text-xxs"},Rt={class:"dark:text-slate-700"},Bt=w(()=>a("div",{class:"overflow-x-auto mt-2"},[a("div",{class:"h-2"})],-1)),Ot={__name:"Index",setup(y){const{t:v}=G(),r=D("rubrics"),u=D([]),l=D([]),$=new Date().toLocaleDateString("ru-RU"),i=new Date().toISOString().slice(0,19).replace(/:/g,"-"),j=async()=>{try{const s=await fetch(`/admin/reports?type=${r.value}`,{headers:{Accept:"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();u.value=t.data,t.data.length>0&&(l.value=Object.keys(t.data[0]))}catch(s){console.error("Не удалось получить данные:",s)}};K(r,j),Q(j);const g=s=>s.map(t=>{const e={};return l.value.forEach(o=>{o==="rubrics"&&Array.isArray(t[o])?e[o]=t[o].map(n=>n.title).join(", "):o==="sections"&&Array.isArray(t[o])?e[o]=t[o].map(n=>n.title).join(", "):o==="articles"&&Array.isArray(t[o])?e[o]=t[o].map(n=>n.title).join(", "):e[o]=t[o]}),typeof e.activity=="boolean"&&(e.activity=e.activity?"true":"false"),e}),x=s=>{switch(s){case"csv":V();break;case"xls":N();break;case"pdf":L();break;case"zip":q();break;case"docx":H();break}},V=()=>{const s=g(u.value),t=p.json_to_sheet(s),e=p.sheet_to_csv(t),o=new Blob(["\uFEFF"+e],{type:"text/csv;charset=utf-8;"});k.saveAs(o,`reports_${r.value}_${i}.csv`)},N=()=>{const s=g(u.value),t=p.json_to_sheet(s),e=p.book_new();p.book_append_sheet(e,t,"Report");const o=B(e,{bookType:"xlsx",type:"array"}),n=new Blob([o],{type:"application/octet-stream"});k.saveAs(n,`reports_${r.value}_${i}.xlsx`)},L=()=>{const s=g(u.value),t=l.value.map(m=>`<th style="padding: 5px; border: 1px solid black;">${m}</th>`).join(""),e=s.map(m=>`<tr>${l.value.map(C=>`<td style="padding: 5px; padding-bottom: 10px; border: 1px solid black;">${m[C]}</td>`).join("")}</tr>`).join(""),o=`
    <html>
      <head>
        <style>
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { padding: 5px; border: 1px solid black; vertical-align: top; }
          h1 { margin-bottom: 20px; }
        </style>
      </head>
      <body>
        <h1>Отчёт: ${r.value==="rubrics"?"Рубрики":r.value==="sections"?"Секции":"Статьи"} - ${$}</h1>
        <table>
          <thead><tr>${t}</tr></thead>
          <tbody>${e}</tbody>
        </table>
      </body>
    </html>
  `,n={margin:.5,filename:`reports_${r.value}_${i}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,letterRendering:!0,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"landscape"}};O().from(o).set(n).save()},q=async()=>{const s=new lt,t=g(u.value),e=p.json_to_sheet(t),o=p.sheet_to_csv(e),n=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"});s.file(`reports_${r.value}_${i}.csv`,n);const m=p.book_new();p.book_append_sheet(m,e,"Report");const F=B(m,{bookType:"xlsx",type:"array"}),C=new Blob([F],{type:"application/octet-stream"});s.file(`reports_${r.value}_${i}.xlsx`,C);const M=document.querySelector("#reportContent"),U={margin:.5,filename:`reports_${r.value}_${i}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,logging:!0,letterRendering:!0,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"landscape"}},X=await O().from(M).set(U).output("blob");s.file(`reports_${r.value}_${i}.pdf`,X);const Z=A(),J=await R.toBlob(Z);s.file(`reports_${r.value}_${i}.docx`,J);const W=await s.generateAsync({type:"blob"});k.saveAs(W,`reports_${r.value}_${i}.zip`)},H=()=>{const s=A();R.toBlob(s).then(t=>{k.saveAs(t,`reports_${r.value}_${i}.docx`)})},A=()=>{const s=g(u.value),t=[new I({children:l.value.map(e=>new E({children:[new T({children:[new z(e)],spacing:{after:200}})]}))})];return s.forEach(e=>{const o=new I({children:l.value.map(n=>new E({children:[new T({children:[new z(String(e[n]))],spacing:{after:200}})]}))});t.push(o)}),new it({sections:[{properties:{page:{size:{orientation:ct.LANDSCAPE}}},children:[new T({text:`Отчёт: ${r.value==="rubrics"?"Рубрики":r.value==="sections"?"Секции":"Статьи"} - ${$}`,heading:"Heading1",spacing:{after:400}}),new dt({rows:t,width:{size:100,type:pt.PERCENTAGE}})]}]})};return(s,t)=>(d(),Y(ut,{title:h(v)("reports")},{header:S(()=>[at(bt,null,{default:S(()=>[st(c(h(v)("reports")),1)]),_:1})]),default:S(()=>[a("div",ht,[a("div",vt,[a("div",null,[a("label",gt,c(h(v)("selectReportType")),1),P(a("select",{id:"reportType","onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),class:"mt-1 block w-full py-1 px-3 border border-gray-300 bg-white dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},_t,512),[[tt,r.value]])]),a("div",ft,[a("button",{onClick:t[1]||(t[1]=e=>x("csv")),class:"inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700"}," CSV "),a("button",{onClick:t[2]||(t[2]=e=>x("xls")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700"}," Excel "),a("button",{onClick:t[3]||(t[3]=e=>x("docx")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"}," Word "),a("button",{onClick:t[4]||(t[4]=e=>x("pdf")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700"}," PDF "),a("button",{onClick:t[5]||(t[5]=e=>x("zip")),class:"ml-2 inline-flex items-center px-2 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-slate-600 hover:bg-slate-700"}," ZIP ")])]),a("div",kt,[a("label",$t,c(h(v)("selectFieldsPrint")),1),a("div",Ct,[(d(!0),b(_,null,f(u.value[0],(e,o)=>(d(),b("div",{key:o},[P(a("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=n=>l.value=n),value:o,class:"form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out"},null,8,Dt),[[et,l.value]]),a("span",St,c(o),1)]))),128))])]),a("div",Tt,[a("h1",jt,c(h(v)("report"))+" "+c(r.value==="rubrics"?"Рубрики":r.value==="sections"?"Секции":"Статьи")+" - "+c(h($)),1),At,a("div",Ft,[a("table",Pt,[a("thead",null,[a("tr",Rt,[(d(!0),b(_,null,f(l.value,e=>(d(),b("th",{key:e,class:"px-4 py-1 dark:bg-gray-900 dark:text-white"},c(e),1))),128))])]),a("tbody",null,[(d(!0),b(_,null,f(u.value,e=>(d(),b("tr",{key:e.id,class:"bg-white dark:bg-gray-800 border-b dark:border-gray-700"},[(d(!0),b(_,null,f(l.value,o=>(d(),b("td",{key:o,class:ot([{truncate:o==="url"||o==="image_url"},"px-4 py-1"])},c(e[o]),3))),128))]))),128))])])]),Bt],512)])]),_:1},8,["title"]))}},Jt=mt(Ot,[["__scopeId","data-v-67060381"]]);export{Jt as default};
